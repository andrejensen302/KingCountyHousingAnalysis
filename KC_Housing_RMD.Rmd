---
title: "KC_Housing_Final"
output: github_document
---

```{r}
#Load libraries

library(dplyr)
library(ggplot2)
library(ggdendro)
library(stringr)
library(corrgram)
library(randomForest)
library(GGally)
library(caret)
library(tidyverse)
library(readxl)
library(rpart)
library(rpart.plot)
library(rsample)

#Set seed for consistent output
set.seed(1234)

#Data wrangling completed in Excel
#All of the data was in one column separted by commas, used delimeter to separate the values into their individual columns

#Import dataset
setwd("~/Documents/RStudio_Uploads/King_County_Housing_Analysis")
kc_house_data_1 <- read_excel("kc_house_data (1).xls")

kc_house_data_1 %>% glimpse()
house_data_set = kc_house_data_1

```

## R Markdown   make a difference

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Prepare data set}
#Prepare dataset

#View class types of variables for possible data type conversion
class(kc_house_data_1$id)
class(kc_house_data_1$view)
class(kc_house_data_1$grade)
class(kc_house_data_1$condition)
class(kc_house_data_1$lat)
class(kc_house_data_1$long)
class(kc_house_data_1$price)

#Remove columns from dataset that won't contribute to a good predictation model
house_data_set$id <- NULL
house_data_set$zipcode <- NULL
house_data_set$yr_renovated <- NULL

#In the interest of creating a simpler model, we are removing the date from the dataset and not look at seasonal trends
house_data_set$date <- NULL

#Change variable types
house_data_set = house_data_set %>% mutate(waterfront = as.factor(waterfront),
                                           view = as.factor(view),
                                           grade = as.factor(grade), 
                                           condition = as.factor(condition), 
                                           lat = as.factor(lat), long = as.factor(long))

#Verify variable type changes
is.factor(house_data_set$waterfront)
is.factor(house_data_set$view)
is.factor(house_data_set$grade)
is.factor(house_data_set$condition)
is.factor(house_data_set$lat)
is.factor(house_data_set$long)
```

```{r Feature Engineering}

#Feature engineering - create categorical variables to analyze mean price against various criteria in the dataset.

#Create variable for Newer Construction (2004 or newer) criteria
house_data_set = house_data_set %>% mutate(new_construction = ifelse(yr_built >= 2004, TRUE, FALSE))

#Create new variable for four bedroom criteria
house_data_set = house_data_set %>% mutate(four_bedroom = ifelse(bedrooms >= 4, TRUE, FALSE))

#Create new variable for 3 bathroom criteria
house_data_set= house_data_set %>% mutate(three_bathroom = ifelse(bathrooms >= 3.00, TRUE, FALSE))

#Create new variable for 4,000 sqft living criteria
house_data_set= house_data_set %>% mutate(sqft_living_criteria = ifelse(sqft_living >= 4000, TRUE, FALSE))

#Create new variable for 4,000 sqft15 living criteria
house_data_set= house_data_set %>% mutate(sqft_living15_criteria = ifelse(sqft_living15 >= 4000, TRUE, FALSE))

#Create new variable for Good grade (7+) criteria
#summary shows that housing grades range from 1 to 13
house_data_set$grade %>% summary()
good_grade_values <- c('7', '8', '9', '10', '11', '12', '13')
house_data_set= house_data_set %>% mutate(good_grade = ifelse(grade %in% good_grade_values, TRUE, FALSE))

#Create variable for good condition (5+) criteria
house_data_set$condition %>% summary
good_condition_values <- c('5')
house_data_set = house_data_set %>% mutate(good_condition = ifelse(condition %in% good_condition_values, TRUE, FALSE))

#Create new variable for 5,000 sqft lot criteria
house_data_set= house_data_set %>% mutate (sqft_lot_criteria = ifelse(sqft_lot >= 5000, TRUE, FALSE))

#Create new variable for 5,000 sqft_lot15 criteria
house_data_set= house_data_set %>% mutate (sqft_lot15_criteria = ifelse(sqft_lot15 >= 5000, TRUE, FALSE))

#Add column for log of sqft_living

house_data_set = house_data_set %>% mutate (log_sqft_living = log10(sqft_living))

#Add column for square root of sqft_living

house_data_set = house_data_set %>% mutate(sqrt_sqft_living = sqrt(sqft_living))

```

```{r}

#Show quick summary of average prices grouped by the individual criteria above 
#(four bedroom, three bathroom, 4,000 sqft living, 7+ good grade, 5+ good condition, & 5,000 sqft lot)

#Average price grouped by four bedroom houses
avg_price_of_four_bedrooms = house_data_set %>% na.omit() %>% 
  group_by(four_bedroom) %>% 
  summarize(mean_price = mean(price))

#Average price grouped by three bathrooms houses
avg_price_of_three_bathrooms = house_data_set %>% na.omit() %>%
  group_by(three_bathroom) %>% 
  summarize(mean_price = mean(price)) 

#Average price grouped by 4,000 sqft_living houses
avg_price_of_4000_sqft = house_data_set %>% na.omit() %>%
  group_by(sqft_living_criteria) %>% 
  summarize(mean_price = mean(price)) 

#Average price grouped by 4,000 sqft_living15 houses
avg_price_of_4000_sqft15 = house_data_set %>% na.omit() %>%
  group_by(sqft_living15_criteria) %>% 
  summarize(mean_price = mean(price)) 

#Average price grouped by 5,000 sqft lot houses
avg_price_of_5000_sqft_lot = house_data_set %>% na.omit() %>%
  group_by(sqft_lot_criteria) %>% 
  summarize(mean_price = mean(price)) 

#Average price grouuped by 5,000 sqft_lot15 houses
avg_price_of_5000_sqft_lot = house_data_set %>% na.omit() %>%
  group_by(sqft_lot15_criteria) %>% 
  summarize(mean_price = mean(price)) 

#Average prices grouped by good condition (5+) houses
avg_price_of_good_condition = house_data_set %>% na.omit() %>%
  group_by(good_condition) %>% 
  summarize(mean_price = mean(price)) 

#Average prices grouped by new construction (>2004 construction) houses
avg_price_of_new_construction = house_data_set %>% na.omit() %>%
  group_by(new_construction) %>% 
  summarize(mean_price = mean(price)) 

#Average prices grouped by good grade (7+)
avg_price_of_good_grade = house_data_set %>% na.omit() %>%
  group_by(good_grade) %>% 
  summarize(mean_price = mean(price)) 

#View summary of data
house_data_set %>% glimpse()
house_data_set %>% summary()

```

```{r Sequence plots, echo=FALSE}

#echo=FALSE to generate pltots without printing the code

housing_data_sequence_plot <- function (data, col){
  
  print_sequence <- data %>% ggplot(mapping = aes_string(x= col %>% seq_along(), y = col))+
    geom_jitter (alpha = .5) + 
    geom_smooth(method="loess") +
    theme_classic() +
    labs(title=str_c("Natural sequence of ", col, " data"),
         subtitle="Using seq_along()")
  
  print_sequence %>% print()
}

#Plot sequence plots
house_data_set %>% housing_data_sequence_plot("bedrooms")
house_data_set %>% housing_data_sequence_plot("price")
house_data_set %>% housing_data_sequence_plot("bathrooms")
house_data_set %>% housing_data_sequence_plot("sqft_living")
house_data_set %>% housing_data_sequence_plot("sqft_lot")

```



```{r pressure, echo=FALSE}

#echo=FALSE to generate pltots without printing the code

#Violin plot to analysize housing data
housing_data_violin_plot <- function(data, x_col,y_col){
  
  print_housing <- data %>% ggplot(mapping = aes_string(x = x_col, y= y_col))+
    geom_violin(draw_quantiles = c(0.25, .05, 0.75),
                fill = 'blue', alpha = 0.3, size = 1.0)+
    labs(title = "Housing data analysis",
         subtitle = str_c("relationship between ", x_col, " & ", y_col))
  
  print_housing %>% print()
}

#Plot violin plots
house_data_set %>% housing_data_violin_plot("grade", "price")
house_data_set %>% housing_data_violin_plot("condition" ,"price")
house_data_set %>% housing_data_violin_plot("waterfront", "price")
house_data_set %>% housing_data_violin_plot("view", "price")


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
